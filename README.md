# QMT Weight Sync

**QMT Weight Sync** 是一个基于 Streamlit 和 MiniQMT (xtquant) 的轻量级自动化交易工具。它旨在帮助量化交易者将每日的策略持仓权重（Excel/CSV）自动转换为实盘交易指令。

## 🚀 核心功能

*   **可视化界面**：Web 界面管理策略与账户，操作简单直观。
*   **智能调仓**：自动计算目标股数（四舍五入到100股），执行“先卖后买”逻辑。
*   **资产监控**：实时查看账户总资产、持仓市值、可用资金。
*   **收益回测**：自动记录账户净值，并生成与上证指数的收益率对比曲线。
*   **灵活输入**：支持上传 `.xlsx` 或 `.csv` 格式的持仓权重文件。

## 📦 安装指南

1.  **克隆或下载项目**：
    ```bash
    git clone <your-repo-url>
    cd qmt_weight_sync
    ```

2.  **安装依赖**：
    使用 `uv` 快速同步依赖：
    ```bash
    uv sync
    ```
    *(注：需手动确保安装了 `xtquant` 库，通常需从 QMT 安装目录复制或手动下载)*

3.  **配置文件**：
    复制 `example.env` 为 `.env` 并根据实际情况修改，或直接修改 `config.py` 中的配置：
    *   `ACCOUNT_ID`: 你的资金账号。
    *   `MINIQMT_PATH`: MiniQMT 用户数据路径 (通常在 `userdata_mini` 文件夹)。
    *   `LOGIN_PASSWORD`: Web 界面登录密码。

## 🖥️ 使用方式

### 1. 启动 Web 界面
在终端运行：
```bash
uv run streamlit run app.py --server.port XXXX
```
启动后，浏览器会自动打开 `http://localhost:XXXX`。

### 2. 启动调度服务 (可选)
如果需要后台定时自动执行调仓（如每日 09:25），请启用调度器：
```bash
uv run python scheduler_service.py
```

### 3. 操作流程
1.  **登录**：输入密码（默认配置见 `config.py`）。
2.  **上传权重**：在“持仓文件上传”区域，上传包含最新策略权重的 Excel/CSV 文件。
3.  **查看概览**：检查“目标持仓”和“账户概览”确认数据无误。
4.  **执行调仓**：
    *   **自动模式**：等待调度服务定时触发。
    *   **手动模式**：在“调仓操作明细”中点击“计算调仓明细”，确认无误后可根据提示逻辑（目前代码主要为计算展示，实际执行需结合 Scheduler 或后续添加手动执行按钮）进行交易。
    *(注：当前 Web 界面主要用于监控和计算明细，实际的全自动下单逻辑集成在 Trader 核心与调度器中)*

## 📄 数据文件格式

上传的 Excel 或 CSV 文件必须包含以下列（表头）：

| 列名 | 说明 | 示例 |
| :--- | :--- | :--- |
| `date` | 交易日期 | 2024-01-29 |
| `stock_code` | 证券代码 (带后缀) | 600519.SH |
| `weight` | 目标持仓权重 (0-1) | 0.15 |